<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" th:href="@{/images/dnd_map_logo.svg}">
    <link th:href="@{/css/layout.css}" rel="stylesheet" />
    <link th:href="@{/css/mid.css}" rel="stylesheet" />
    <link id="theme" th:href="@{/css/lightmode.css}" rel="stylesheet"  type="text/css"/>
    <script>
        document.getElementById('cookie').innerHTML=showIcon()
        function showIcon() {
            var cookies = document.cookie.split(';');
            var isEnabled = cookies[0].split('=')[1] === "true";

            if(isEnabled){
                document.getElementById('theme').href = "/css/darkmode.css";
            }

            return isEnabled ? "☾" : "☼";
        }
    </script>
    <title>Edit place</title>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<main>
    <div class="edit_place">
        <div class="top"><h2>Edit Place</h2></div>
        <div class="left">
            <form th:action="@{/edit-place/processing}" enctype="multipart/form-data" method="post">
                <p th:if="${edit_place_error} != null" th:text="${edit_place_error}" class="error_message"/>
                <label for="plname">Name</label>
                <input type="text" name="plname" id="plname"></br>

                <label for="pltype">Type</label>
                <input type="text" name="pltype" id="pltype"></br>

                <label for="plparent">Parent</label>
                <select class="select" name="plparent" id="plparent">
                    <option th:if="${currentPlace.getParent()}==${null}" th:value="${-1}" selected>No parent</option>
                    <option th:if="${worldDAO.getById(worldId).getRootPlace()}!=${null}" th:each="place,iter : ${places}" th:text="${place.getName()}" th:value="${place.getId()}">Parent place name</option>
                </select></br><br>

                <label for="mapfile">Map</label>
                <label for="mapfile"><input type="file" name="mapfile" id="mapfile"/></label></br>

                <label for="desc">Description</label>
                <textarea name="desc" id="desc"></textarea></br>

                <label for="notes">Notes</label>
                <textarea name="notes" id="notes"></textarea></br>

                <input class="save bbutton" th:type="submit" value="Save">
                <input class="button" type="hidden" th:name="placeId" th:value="${currentPlace.getId()}">
                <input th:if="${currentPlace.getParent()}!=${null}" class="remove bbutton" th:type="submit" value="Remove place">
            </form>
        </div>
        <div class="right">
            <form th:each="child,iter:${children}" style="display: none" th:id="${child.getId()}" th:action="@{/delete-place}" method="get">
                <input hidden="hidden" name="id" th:value="${child.getId()}" />
            </form>

            <label style="padding-top: 20px">Appearances</label>
            <table>
                <colgroup>
                    <col span="1" style="width: 40%;">
                    <col span="1" style="width: 20%;">
                    <col span="1" style="width: 10%;">
                    <col span="1" style="width: 15%;">
                    <col span="1" style="width: 15%;">
                </colgroup>
                <tr>
                    <th>Place</th>
                    <th>Coordinates</th>
                    <th>Z-Axis</th>
                    <th></th>
                    <th></th>
                </tr>
                <tr th:each="child,iter:${children}">
                    <form id="appearance" th:action="@{/edit-place/appearance}" method="post">
                    <td th:text="${child.getName()}">Child 1</td>
                    <td><input class="right_input coords" th:type="text" name="coord"></td>
                    <td><input class="right_input zaxis" th:type="text" name="z-axis"></td>
                        <td>
                            <button th:href="." class="bbutton" id="add_child" type="submit" th:name="childId" th:value="${child.getId()}">Add</button>
                            <input type="hidden" th:name="placeId" th:value="${currentPlace.getId()}">
                        </td>
                    <td><button class="remove bbutton" id="remove_child" th:form="${child.getId()}" th:type="submit" th:value="${child.getId()}">Remove</button></td>
                    </form>
                </tr>
            </table>
            <div>
                <select class="select" id="plparent_right" th:onchange="eventA()">
                    <option th:each="child,iter:${appearanceDAO.getAllByLocation(currentPlace, false)}" th:text="${child.getPlace().getName()}" th:value="${child.getCoordinates()}">Child place name</option>
                    <!--<option>More...</option>-->
                </select></br>
                <input disabled class="select" type="text">
            </div>
            <div>
                <img th:if="${currentPlace.getMapPath()}!=${null}" id="editplace_picture" th:src="@{/img(path=${currentPlace.getMapPath()})}">
            </div>
            <br>

        </div>
    </div>

    <script>
        function eventA(){
            //let textBox = selector.nextElementSibling;
            //textBox.textContent = selector.valueOf();
            var selector = document.getElementById("plparent_right");
            let textBox = selector.nextElementSibling.nextElementSibling;
            textBox.value = selector.value;
//var text = e.options[e.selectedIndex].text;
        }
    </script>
</main>
</body>
</html>